{% extends "core/base_panel.html" %}
{% load static %}

{% block title %}Panel Farmacia | PetComunity{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'productos/css/panel_farmacia.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard">

  <!-- M√≥dulo Perfil -->
  <div class="dashboard-module profile-details-module">
    <h3>üìã Mi Perfil</h3>
    <div class="profile-summary">
      <div class="profile-image-wrapper">
        {% if user.profile.imagen %}
          <img src="{{ user.profile.imagen.url }}" alt="Foto de perfil" class="profile-dashboard-image">
        {% else %}
          <img src="{% static 'img/default-profile.png' %}" alt="Foto por defecto" class="profile-dashboard-image">
        {% endif %}
      </div>

      <div class="profile-info">
        <p><strong>Nombre:</strong> {{ user.profile.nombre_clinica|default:user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Tel√©fono:</strong> {{ user.profile.telefono|default:"No especificado" }}</p>
        <p><strong>Direcci√≥n:</strong> {{ user.profile.direccion|default:"No especificada" }}</p>

        <form id="form-estado-perfil" method="post" action="{% url 'editar_perfil_farmacia' %}" style="margin-top: 1rem;">
          {% csrf_token %}
          <div class="estado-switch-container">
            <p><strong>Perfil p√∫blico:</strong></p>
            <label class="switch">
              <input type="checkbox" name="perfil_publicado" {% if user.profile.perfil_publicado %}checked{% endif %} onchange="document.getElementById('form-estado-perfil').submit();">
              <span class="slider"></span>
            </label>
            <span style="margin-left: 10px;">
              {% if user.profile.perfil_publicado %}‚úÖ S√≠{% else %}‚ùå No{% endif %}
            </span>
          </div>
        </form>

        <a href="{% url 'editar_perfil_farmacia' %}" class="btn" style="margin-top: 1rem;">‚úèÔ∏è Editar Perfil</a>
      </div>
    </div>
  </div>

  <!-- M√≥dulo Productos -->
  <div class="dashboard-module">
    <h3>üõçÔ∏è Productos publicados</h3>
    
    <div class="boton-agregar-producto" style="text-align: right; margin-bottom: 1rem;">
      <a href="{% url 'productos:subir_producto' %}" class="btn btn-primary">+ Subir Producto</a>

    </div>
    
    {% if productos %}
    <table class="tabla-productos" style="width: 100%; border-collapse: collapse;">
      <thead style="background-color: #f0f0f0;">
        <tr>
          <th>Imagen</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        {% for producto in productos %}
        <tr>
          <td>
            {% if producto.imagen %}
              <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" width="60" height="60" style="object-fit: cover; border-radius: 6px;">
            {% else %}
              <span style="color: #999;">Sin imagen</span>
            {% endif %}
          </td>
          <td>{{ producto.nombre }}</td>
          <td>${{ producto.precio }}</td>
          <td>{{ producto.stock }}</td>
          <td>{{ producto.estado }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>No tienes productos registrados a√∫n.</p>
    {% endif %}
  </div>


  <!-- M√≥dulo Pedidos -->
  <div class="dashboard-module">
    <h3>üì¶ Pedidos Recibidos</h3>
    {% if pedidos %}
      <table class="tabla-pedidos">
        <thead>
          <tr>
            <th>ID Pedido</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Items</th>
          </tr>
        </thead>
        <tbody>
          {% for pedido in pedidos %}
          <tr>
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.cliente.username }}</td>
            <td>{{ pedido.creado|date:"d M Y H:i" }}</td>
            <td>{{ pedido.estado }}</td>
            <td>
              <ul>
                {% for item in pedido.items.all %}
                <li>{{ item.producto.nombre }} - Cantidad: {{ item.cantidad }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>üì≠ No tienes pedidos a√∫n.</p>
    {% endif %}
  </div>

</div>
{% endblock %}
