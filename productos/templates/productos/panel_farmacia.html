{% extends "base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'productos/css/panel_farmacia.css' %}">
{% endblock %}
{% block content %}
<div class="panel-farmacia">
  <h2>üõçÔ∏è Panel de Farmacia</h2>
  <a href="{% url 'productos:subir_producto' %}" class="btn btn-primary">‚ûï Subir nuevo producto</a>

  {% if productos %}
  <div class="productos-lista">
    <table>
        <thead>
            <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Descripci√≥n</th>
            <th>Acciones</th> <!-- Nueva columna -->
            </tr>
        </thead>
        <tbody>
            {% for producto in productos %}
            <tr>
            <td>
                {% if producto.imagen %}
                <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" style="width: 80px; height: auto;">
                {% else %}
                Sin imagen
                {% endif %}
            </td>
            <td>{{ producto.nombre }}</td>
            <td>${{ producto.precio }}</td>
            <td>{{ producto.stock }}</td>
            <td>{{ producto.descripcion|default:"-" }}</td>
            <td>
                <a href="{% url 'productos:editar_producto' producto.id %}" class="btn btn-sm btn-warning">Editar</a>
                <form action="{% url 'productos:eliminar_producto' producto.id %}" method="POST" style="display:inline;" onsubmit="return confirmarEliminacion();">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
                </form>

            </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
  {% else %}
    <p>No tienes productos subidos a√∫n.</p>
  {% endif %}

  <hr>

  <h2>üì¶ Pedidos recibidos</h2>

  {% if pedidos %}
  <table>
    <thead>
      <tr>
        <th>ID Pedido</th>
        <th>Cliente</th>
        <th>Fecha</th>
        <th>Productos</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody>
      {% for pedido in pedidos %}
      <tr>
        <td>{{ pedido.id }}</td>
        <td>{{ pedido.cliente.username }}</td>
        <td>{{ pedido.creado|date:"d/m/Y H:i" }}</td>
        <td>
          <ul>
            {% for item in pedido.items.all %}
            <li>{{ item.producto.nombre }} ‚Äî Cantidad: {{ item.cantidad }}</li>
            {% endfor %}
          </ul>
        </td>
        <td>{{ pedido.completado|yesno:"Completado,Pendiente" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No tienes pedidos a√∫n.</p>
  {% endif %}

</div>
{% block extra_js %}
<script>
function confirmarEliminacion() {
    return confirm("¬øEst√°s seguro de que quieres eliminar este producto?");
}
</script>
{% endblock %}
{% endblock %}
